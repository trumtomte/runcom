# Variables, Hooks and Mailboxes
# =========
set my_doris_pass   = `pass Doris/loopia/sebastian@doris.tech`
set my_mau_pass     = `pass Sebbe/MaU/sebastian.bengtegard@mau.se`
set my_pm_pass      = `pass Sebbe/protonbridge`
# set my_gmail_pass   = `pass Sebbe/Google/gmail_mutt`

folder-hook doris source ~/.mutt/account.tech.doris.sebastian
folder-hook mau source ~/.mutt/account.se.mau.sebastianbengtegard
folder-hook pm source ~/.mutt/account.me.pm.sebastianbengtegard
# folder-hook gmail source ~/.mutt/account.com.gmail.sebbebook

mailboxes +Doris +doris/INBOX +doris/sent +doris/archive
mailboxes +MaU +mau/INBOX +mau/sent +mau/deleted +mau/archive
mailboxes +PM +pm/INBOX +pm/sent +pm/deleted +pm/archive
# mailboxes +Gmail +gmail/INBOX +gmail/sent +gmail/archive

# Initial account + Colorscheme
source ~/.mutt/account.me.pm.sebastianbengtegard
source ~/.mutt/sherlock.mutt

# Configuration
# =============
unset beep
unset markers
unset imap_check_subscribed
unset imap_list_subscribed

set charset                 = "utf-8"
set mailcap_path            = "~/.mutt/.mailcap"
set editor                  = "vim"
set mbox_type               = Maildir
set folder                  = "~/Mail"
set tmpdir                  = "+tmp"
set postponed               = "+postponed"
set header_cache            = "+cache_headers"
set message_cachedir        = "+cache_bodies"
set certificate_file        = "+certificates"
set display_filter          = "/usr/bin/sed /./,/^$/!d"
set edit_headers            = yes
set mail_check              = 0
set mail_check_stats        = yes
set timeout                 = 3
set wait_key                = no
set quit                    = ask-yes
set fast_reply              = yes
set include                 = yes
set forward_format          = "Fwd: %s"
set forward_quote           = yes
set menu_scroll             = yes
set pager_stop              = yes 
set sort                    = reverse-threads
set sort_aux                = last-date-received
set status_chars            = " +RA"
set status_format           = "%r %f [%m messages%?n?, %n new?%?d?, %d to delete?%?t?, %t tagged?%?p?, %p postponed?]"
set compose_format          = "[Compose] %h [Size: %l, Attachments: %a] %v"
set date_format             = "%d.%m.%y %H:%M"
set index_format            = "%4C [%Z] %?X?A&-? %D  %-20.20F  %s"
set pager_index_lines       = 5
set pager_context           = 3
set query_command           = "mu cfind --format=mutt-ab '%s'"
set rfc2047_parameters      = yes # Fixes issue with PDF-naming

# Sidebar
# =======
set sidebar_visible
set sidebar_short_path
set sidebar_folder_indent
set sidebar_width           = 25
set sidebar_divider_char    = ' | '
set sidebar_indent_string   = '  '
set sidebar_format          = "%B %* [%?N?%N/?%S]"

# Ordering & Auto_view
# ====================
auto_view text/html application/octet-stream
ignore *
unignore date: from: to: cc: bcc: subject:
unhdr_order *
hdr_order date: from: to: cc: bcc: subject:
unalternative_order *
alternative_order multipart/mixed multipart/related multipart/alternative text/plain text/html *

# Macros
# ======
macro index,pager <f1> "<change-folder>+doris/INBOX<enter>"
macro index,pager <f2> "<change-folder>+mau/INBOX<enter>"
macro index,pager <f3> "<change-folder>+pm/INBOX<enter>"

macro index,pager ,u \
    "<enter-command>set pipe_decode = yes<enter><pipe-message>urlview<enter><enter-command>set pipe_decode = no<enter>" \
    "Call urlview to extract URLs out of a message"

macro attach,compose ,u \
    "<enter-command>set pipe_decode = yes<enter><pipe-entry>urlview<enter><enter-command>set pipe_decode = no<enter>" \
    "Call urlview to extract URLs out of a message"

macro index S \
    "<shell-escape>mu find --clearlinks --format=links --linksdir=~/Mail/search " \
    "Search via mu-find"

macro index ,s \
    "<change-folder-readonly>~/Mail/search<enter>" \
    "Show search results from mu-find"

macro index,pager ยง \
    "<shell-escape>clear && mbsync -a<enter>" \
    "Sync all mail"

macro index I \
    "<shell-escape>clear && mu index --maildir=~/Mail<enter>" \
    "Index all mail"

macro attach S \
    "<save-entry><kill-line>~/Downloads/<enter>\y<enter>" \
    "Save attachment to the Downloads folder"

# Bindings
# ========
bind editor <Tab>       complete-query
bind index <Space>      collapse-thread
bind index <Tab>        collapse-all
bind pager j            next-line
bind pager k            previous-line
bind index J            next-unread
bind pager J            next-undeleted
bind index K            previous-unread
bind pager K            previous-undeleted
bind index gg           first-entry
bind pager gg           top
bind index G            last-entry
bind pager G            bottom
bind index,pager R      group-reply
bind index,pager \Cu    half-up
bind index,pager \Cd    half-down
